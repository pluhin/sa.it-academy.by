---

- hosts: all
  gather_facts: false
  tasks:
    - name: Add user ansible
      become: yes
      user:
       name: ansible
       comment: Ansible user
       shell: /bin/bash
       groups: sudo
       append: yes
       password: $6$8bqr3uyJQDR$XJSrtwhghLXVkLiTDC4SO3aOi0GpLYttjMadJtvcvU3PAig24hWdggbXAf5gssGVVL6CKSWj/APCnx3gJYw/F1
       state: present
    - name: Add sudo nopasswd
      become: true
      lineinfile:
        dest: /etc/sudoers
        state: present
        insertbefore: '^#includedir'
        line: 'ansible ALL=(ALL) NOPASSWD: ALL'
        validate: '/usr/sbin/visudo -cf %s'
    - name: Allow ssh connect via password
      become: true
      lineinfile:
        dest: /etc/ssh/sshd_config
        state: present
        regexp: '^PasswordAuthentication'
        line: 'PasswordAuthentication yes'
    - name: Restart ssh service
      become: true
      service:
        name: ssh
        state: restarted
        

    