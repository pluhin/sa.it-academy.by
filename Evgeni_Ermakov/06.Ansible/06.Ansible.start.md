# 06. Ansible start

* [Playbook](playbook.yaml)

## Ansible ad-hoc

### Check content of /etc/hosts file

```bash
evgeni@legion:~/devOps/06_Ansible$ ansible -i inventory.yaml -m shell -a "cat /etc/hosts" all_workers -u root
host10 | CHANGED | rc=0 >>
127.0.0.1	localhost
::1		localhost ip6-localhost ip6-loopback
ff02::1		ip6-allnodes
ff02::2		ip6-allrouters
# --- BEGIN PVE ---
192.168.202.10 sa-ubuntu-10.it-academy.local sa-ubuntu-10
# --- END PVE ---
host9 | CHANGED | rc=0 >>
127.0.1.1	LXC_NAME
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
# --- BEGIN PVE ---
192.168.202.9 sa-centos-9.it-academy.local sa-centos-9
# --- END PVE ---
````

### Install nginx service

````bash
evgeni@legion:~/devOps/06_Ansible$ ansible -i inventory.yaml -m ansible.builtin.package -a "name=nginx state=latest" all_workers -u root
host9 | CHANGED => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/libexec/platform-python"
    },
    "changed": true,
    "msg": "",
    "rc": 0,
    "results": [
        "Installed: nginx-mod-stream-1:1.14.1-9.module_el8.0.0+184+e34fea82.x86_64",
        "Installed: libpng-2:1.6.34-5.el8.x86_64",
        "Installed: libXpm-3.5.12-8.el8.x86_64",
        "Installed: jbigkit-libs-2.1-14.el8.x86_64",
        "Installed: fontconfig-2.13.1-4.el8.x86_64",
        "Installed: fontpackages-filesystem-1.44-22.el8.noarch",
        "Installed: libxslt-1.1.32-6.el8.x86_64",
        "Installed: libwebp-1.0.0-5.el8.x86_64",
        "Installed: freetype-2.9.1-4.el8_3.1.x86_64",
        "Installed: libjpeg-turbo-1.5.3-12.el8.x86_64",
        "Installed: nginx-1:1.14.1-9.module_el8.0.0+184+e34fea82.x86_64",
        "Installed: gd-2.2.5-7.el8.x86_64",
        "Installed: libX11-1.6.8-5.el8.x86_64",
        "Installed: libX11-common-1.6.8-5.el8.noarch",
        "Installed: nginx-all-modules-1:1.14.1-9.module_el8.0.0+184+e34fea82.noarch",
        "Installed: libxcb-1.13.1-1.el8.x86_64",
        "Installed: nginx-filesystem-1:1.14.1-9.module_el8.0.0+184+e34fea82.noarch",
        "Installed: nginx-mod-http-image-filter-1:1.14.1-9.module_el8.0.0+184+e34fea82.x86_64",
        "Installed: dejavu-fonts-common-2.35-7.el8.noarch",
        "Installed: libXau-1.0.9-3.el8.x86_64",
        "Installed: nginx-mod-http-perl-1:1.14.1-9.module_el8.0.0+184+e34fea82.x86_64",
        "Installed: libtiff-4.0.9-20.el8.x86_64",
        "Installed: dejavu-sans-fonts-2.35-7.el8.noarch",
        "Installed: nginx-mod-http-xslt-filter-1:1.14.1-9.module_el8.0.0+184+e34fea82.x86_64",
        "Installed: nginx-mod-mail-1:1.14.1-9.module_el8.0.0+184+e34fea82.x86_64"
    ]
}
host10 | CHANGED => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python3"
    },
    "cache_update_time": 1658613663,
    "cache_updated": false,
    "changed": true,
    "stderr": "",
    "stderr_lines": [],
    "stdout": "Reading package lists...\nBuilding dependency tree...\nReading state information...\nThe following additional packages will be installed:\n  libgd3 libjbig0 libjpeg-turbo8 libjpeg8 libnginx-mod-http-image-filter\n  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5\n  libwebp6 libxslt1.1 nginx-common nginx-core\nSuggested packages:\n  libgd-tools fcgiwrap nginx-doc\nThe following NEW packages will be installed:\n  libgd3 libjbig0 libjpeg-turbo8 libjpeg8 libnginx-mod-http-image-filter\n  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5\n  libwebp6 libxslt1.1 nginx nginx-common nginx-core\n0 upgraded, 14 newly installed, 0 to remove and 166 not upgraded.\nNeed to get 1367 kB of archives.\nAfter this operation, 4782 kB of additional disk space will be used.\nGet:1 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 libjpeg-turbo8 amd64 2.0.3-0ubuntu1.20.04.1 [117 kB]\nGet:2 http://archive.ubuntu.com/ubuntu focal/main amd64 libjpeg8 amd64 8c-2ubuntu8 [2194 B]\nGet:3 http://archive.ubuntu.com/ubuntu focal/main amd64 libjbig0 amd64 2.1-3.1build1 [26.7 kB]\nGet:4 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 libwebp6 amd64 0.6.1-2ubuntu0.20.04.1 [185 kB]\nGet:5 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 libtiff5 amd64 4.1.0+git191117-2ubuntu0.20.04.3 [162 kB]\nGet:6 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 libgd3 amd64 2.2.5-5.2ubuntu2.1 [118 kB]\nGet:7 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 nginx-common all 1.18.0-0ubuntu1.3 [37.7 kB]\nGet:8 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 libnginx-mod-http-image-filter amd64 1.18.0-0ubuntu1.3 [14.8 kB]\nGet:9 http://archive.ubuntu.com/ubuntu focal/main amd64 libxslt1.1 amd64 1.1.34-4 [152 kB]\nGet:10 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 libnginx-mod-http-xslt-filter amd64 1.18.0-0ubuntu1.3 [13.0 kB]\nGet:11 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 libnginx-mod-mail amd64 1.18.0-0ubuntu1.3 [42.8 kB]\nGet:12 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 libnginx-mod-stream amd64 1.18.0-0ubuntu1.3 [67.3 kB]\nGet:13 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 nginx-core amd64 1.18.0-0ubuntu1.3 [425 kB]\nGet:14 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 nginx all 1.18.0-0ubuntu1.3 [3620 B]\nPreconfiguring packages ...\nFetched 1367 kB in 1s (1564 kB/s)\nSelecting previously unselected package libjpeg-turbo8:amd64.\r\n(Reading database ... \r(Reading database ... 5%\r(Reading database ... 10%\r(Reading database ... 15%\r(Reading database ... 20%\r(Reading database ... 25%\r(Reading database ... 30%\r(Reading database ... 35%\r(Reading database ... 40%\r(Reading database ... 45%\r(Reading database ... 50%\r(Reading database ... 55%\r(Reading database ... 60%\r(Reading database ... 65%\r(Reading database ... 70%\r(Reading database ... 75%\r(Reading database ... 80%\r(Reading database ... 85%\r(Reading database ... 90%\r(Reading database ... 95%\r(Reading database ... 100%\r(Reading database ... 23077 files and directories currently installed.)\r\nPreparing to unpack .../00-libjpeg-turbo8_2.0.3-0ubuntu1.20.04.1_amd64.deb ...\r\nUnpacking libjpeg-turbo8:amd64 (2.0.3-0ubuntu1.20.04.1) ...\r\nSelecting previously unselected package libjpeg8:amd64.\r\nPreparing to unpack .../01-libjpeg8_8c-2ubuntu8_amd64.deb ...\r\nUnpacking libjpeg8:amd64 (8c-2ubuntu8) ...\r\nSelecting previously unselected package libjbig0:amd64.\r\nPreparing to unpack .../02-libjbig0_2.1-3.1build1_amd64.deb ...\r\nUnpacking libjbig0:amd64 (2.1-3.1build1) ...\r\nSelecting previously unselected package libwebp6:amd64.\r\nPreparing to unpack .../03-libwebp6_0.6.1-2ubuntu0.20.04.1_amd64.deb ...\r\nUnpacking libwebp6:amd64 (0.6.1-2ubuntu0.20.04.1) ...\r\nSelecting previously unselected package libtiff5:amd64.\r\nPreparing to unpack .../04-libtiff5_4.1.0+git191117-2ubuntu0.20.04.3_amd64.deb ...\r\nUnpacking libtiff5:amd64 (4.1.0+git191117-2ubuntu0.20.04.3) ...\r\nSelecting previously unselected package libgd3:amd64.\r\nPreparing to unpack .../05-libgd3_2.2.5-5.2ubuntu2.1_amd64.deb ...\r\nUnpacking libgd3:amd64 (2.2.5-5.2ubuntu2.1) ...\r\nSelecting previously unselected package nginx-common.\r\nPreparing to unpack .../06-nginx-common_1.18.0-0ubuntu1.3_all.deb ...\r\nUnpacking nginx-common (1.18.0-0ubuntu1.3) ...\r\nSelecting previously unselected package libnginx-mod-http-image-filter.\r\nPreparing to unpack .../07-libnginx-mod-http-image-filter_1.18.0-0ubuntu1.3_amd64.deb ...\r\nUnpacking libnginx-mod-http-image-filter (1.18.0-0ubuntu1.3) ...\r\nSelecting previously unselected package libxslt1.1:amd64.\r\nPreparing to unpack .../08-libxslt1.1_1.1.34-4_amd64.deb ...\r\nUnpacking libxslt1.1:amd64 (1.1.34-4) ...\r\nSelecting previously unselected package libnginx-mod-http-xslt-filter.\r\nPreparing to unpack .../09-libnginx-mod-http-xslt-filter_1.18.0-0ubuntu1.3_amd64.deb ...\r\nUnpacking libnginx-mod-http-xslt-filter (1.18.0-0ubuntu1.3) ...\r\nSelecting previously unselected package libnginx-mod-mail.\r\nPreparing to unpack .../10-libnginx-mod-mail_1.18.0-0ubuntu1.3_amd64.deb ...\r\nUnpacking libnginx-mod-mail (1.18.0-0ubuntu1.3) ...\r\nSelecting previously unselected package libnginx-mod-stream.\r\nPreparing to unpack .../11-libnginx-mod-stream_1.18.0-0ubuntu1.3_amd64.deb ...\r\nUnpacking libnginx-mod-stream (1.18.0-0ubuntu1.3) ...\r\nSelecting previously unselected package nginx-core.\r\nPreparing to unpack .../12-nginx-core_1.18.0-0ubuntu1.3_amd64.deb ...\r\nUnpacking nginx-core (1.18.0-0ubuntu1.3) ...\r\nSelecting previously unselected package nginx.\r\nPreparing to unpack .../13-nginx_1.18.0-0ubuntu1.3_all.deb ...\r\nUnpacking nginx (1.18.0-0ubuntu1.3) ...\r\nSetting up nginx-common (1.18.0-0ubuntu1.3) ...\r\nCreated symlink /etc/systemd/system/multi-user.target.wants/nginx.service → /lib/systemd/system/nginx.service.\r\nSetting up libjbig0:amd64 (2.1-3.1build1) ...\r\nSetting up libwebp6:amd64 (0.6.1-2ubuntu0.20.04.1) ...\r\nSetting up libjpeg-turbo8:amd64 (2.0.3-0ubuntu1.20.04.1) ...\r\nSetting up libxslt1.1:amd64 (1.1.34-4) ...\r\nSetting up libjpeg8:amd64 (8c-2ubuntu8) ...\r\nSetting up libnginx-mod-mail (1.18.0-0ubuntu1.3) ...\r\nSetting up libnginx-mod-stream (1.18.0-0ubuntu1.3) ...\r\nSetting up libnginx-mod-http-xslt-filter (1.18.0-0ubuntu1.3) ...\r\nSetting up libtiff5:amd64 (4.1.0+git191117-2ubuntu0.20.04.3) ...\r\nSetting up libgd3:amd64 (2.2.5-5.2ubuntu2.1) ...\r\nSetting up libnginx-mod-http-image-filter (1.18.0-0ubuntu1.3) ...\r\nSetting up nginx-core (1.18.0-0ubuntu1.3) ...\r\nSetting up nginx (1.18.0-0ubuntu1.3) ...\r\nProcessing triggers for ufw (0.36-6) ...\r\nProcessing triggers for systemd (245.4-4ubuntu3) ...\r\nProcessing triggers for man-db (2.9.1-1) ...\r\nProcessing triggers for libc-bin (2.31-0ubuntu9) ...\r\n",
    "stdout_lines": [
        "Reading package lists...",
        "Building dependency tree...",
        "Reading state information...",
        "The following additional packages will be installed:",
        "  libgd3 libjbig0 libjpeg-turbo8 libjpeg8 libnginx-mod-http-image-filter",
        "  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5",
        "  libwebp6 libxslt1.1 nginx-common nginx-core",
        "Suggested packages:",
        "  libgd-tools fcgiwrap nginx-doc",
        "The following NEW packages will be installed:",
        "  libgd3 libjbig0 libjpeg-turbo8 libjpeg8 libnginx-mod-http-image-filter",
        "  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5",
        "  libwebp6 libxslt1.1 nginx nginx-common nginx-core",
        "0 upgraded, 14 newly installed, 0 to remove and 166 not upgraded.",
        "Need to get 1367 kB of archives.",
        "After this operation, 4782 kB of additional disk space will be used.",
        "Get:1 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 libjpeg-turbo8 amd64 2.0.3-0ubuntu1.20.04.1 [117 kB]",
        "Get:2 http://archive.ubuntu.com/ubuntu focal/main amd64 libjpeg8 amd64 8c-2ubuntu8 [2194 B]",
        "Get:3 http://archive.ubuntu.com/ubuntu focal/main amd64 libjbig0 amd64 2.1-3.1build1 [26.7 kB]",
        "Get:4 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 libwebp6 amd64 0.6.1-2ubuntu0.20.04.1 [185 kB]",
        "Get:5 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 libtiff5 amd64 4.1.0+git191117-2ubuntu0.20.04.3 [162 kB]",
        "Get:6 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 libgd3 amd64 2.2.5-5.2ubuntu2.1 [118 kB]",
        "Get:7 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 nginx-common all 1.18.0-0ubuntu1.3 [37.7 kB]",
        "Get:8 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 libnginx-mod-http-image-filter amd64 1.18.0-0ubuntu1.3 [14.8 kB]",
        "Get:9 http://archive.ubuntu.com/ubuntu focal/main amd64 libxslt1.1 amd64 1.1.34-4 [152 kB]",
        "Get:10 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 libnginx-mod-http-xslt-filter amd64 1.18.0-0ubuntu1.3 [13.0 kB]",
        "Get:11 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 libnginx-mod-mail amd64 1.18.0-0ubuntu1.3 [42.8 kB]",
        "Get:12 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 libnginx-mod-stream amd64 1.18.0-0ubuntu1.3 [67.3 kB]",
        "Get:13 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 nginx-core amd64 1.18.0-0ubuntu1.3 [425 kB]",
        "Get:14 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 nginx all 1.18.0-0ubuntu1.3 [3620 B]",
        "Preconfiguring packages ...",
        "Fetched 1367 kB in 1s (1564 kB/s)",
        "Selecting previously unselected package libjpeg-turbo8:amd64.",
        "(Reading database ... ",
        "(Reading database ... 5%",
        "(Reading database ... 10%",
        "(Reading database ... 15%",
        "(Reading database ... 20%",
        "(Reading database ... 25%",
        "(Reading database ... 30%",
        "(Reading database ... 35%",
        "(Reading database ... 40%",
        "(Reading database ... 45%",
        "(Reading database ... 50%",
        "(Reading database ... 55%",
        "(Reading database ... 60%",
        "(Reading database ... 65%",
        "(Reading database ... 70%",
        "(Reading database ... 75%",
        "(Reading database ... 80%",
        "(Reading database ... 85%",
        "(Reading database ... 90%",
        "(Reading database ... 95%",
        "(Reading database ... 100%",
        "(Reading database ... 23077 files and directories currently installed.)",
        "Preparing to unpack .../00-libjpeg-turbo8_2.0.3-0ubuntu1.20.04.1_amd64.deb ...",
        "Unpacking libjpeg-turbo8:amd64 (2.0.3-0ubuntu1.20.04.1) ...",
        "Selecting previously unselected package libjpeg8:amd64.",
        "Preparing to unpack .../01-libjpeg8_8c-2ubuntu8_amd64.deb ...",
        "Unpacking libjpeg8:amd64 (8c-2ubuntu8) ...",
        "Selecting previously unselected package libjbig0:amd64.",
        "Preparing to unpack .../02-libjbig0_2.1-3.1build1_amd64.deb ...",
        "Unpacking libjbig0:amd64 (2.1-3.1build1) ...",
        "Selecting previously unselected package libwebp6:amd64.",
        "Preparing to unpack .../03-libwebp6_0.6.1-2ubuntu0.20.04.1_amd64.deb ...",
        "Unpacking libwebp6:amd64 (0.6.1-2ubuntu0.20.04.1) ...",
        "Selecting previously unselected package libtiff5:amd64.",
        "Preparing to unpack .../04-libtiff5_4.1.0+git191117-2ubuntu0.20.04.3_amd64.deb ...",
        "Unpacking libtiff5:amd64 (4.1.0+git191117-2ubuntu0.20.04.3) ...",
        "Selecting previously unselected package libgd3:amd64.",
        "Preparing to unpack .../05-libgd3_2.2.5-5.2ubuntu2.1_amd64.deb ...",
        "Unpacking libgd3:amd64 (2.2.5-5.2ubuntu2.1) ...",
        "Selecting previously unselected package nginx-common.",
        "Preparing to unpack .../06-nginx-common_1.18.0-0ubuntu1.3_all.deb ...",
        "Unpacking nginx-common (1.18.0-0ubuntu1.3) ...",
        "Selecting previously unselected package libnginx-mod-http-image-filter.",
        "Preparing to unpack .../07-libnginx-mod-http-image-filter_1.18.0-0ubuntu1.3_amd64.deb ...",
        "Unpacking libnginx-mod-http-image-filter (1.18.0-0ubuntu1.3) ...",
        "Selecting previously unselected package libxslt1.1:amd64.",
        "Preparing to unpack .../08-libxslt1.1_1.1.34-4_amd64.deb ...",
        "Unpacking libxslt1.1:amd64 (1.1.34-4) ...",
        "Selecting previously unselected package libnginx-mod-http-xslt-filter.",
        "Preparing to unpack .../09-libnginx-mod-http-xslt-filter_1.18.0-0ubuntu1.3_amd64.deb ...",
        "Unpacking libnginx-mod-http-xslt-filter (1.18.0-0ubuntu1.3) ...",
        "Selecting previously unselected package libnginx-mod-mail.",
        "Preparing to unpack .../10-libnginx-mod-mail_1.18.0-0ubuntu1.3_amd64.deb ...",
        "Unpacking libnginx-mod-mail (1.18.0-0ubuntu1.3) ...",
        "Selecting previously unselected package libnginx-mod-stream.",
        "Preparing to unpack .../11-libnginx-mod-stream_1.18.0-0ubuntu1.3_amd64.deb ...",
        "Unpacking libnginx-mod-stream (1.18.0-0ubuntu1.3) ...",
        "Selecting previously unselected package nginx-core.",
        "Preparing to unpack .../12-nginx-core_1.18.0-0ubuntu1.3_amd64.deb ...",
        "Unpacking nginx-core (1.18.0-0ubuntu1.3) ...",
        "Selecting previously unselected package nginx.",
        "Preparing to unpack .../13-nginx_1.18.0-0ubuntu1.3_all.deb ...",
        "Unpacking nginx (1.18.0-0ubuntu1.3) ...",
        "Setting up nginx-common (1.18.0-0ubuntu1.3) ...",
        "Created symlink /etc/systemd/system/multi-user.target.wants/nginx.service → /lib/systemd/system/nginx.service.",
        "Setting up libjbig0:amd64 (2.1-3.1build1) ...",
        "Setting up libwebp6:amd64 (0.6.1-2ubuntu0.20.04.1) ...",
        "Setting up libjpeg-turbo8:amd64 (2.0.3-0ubuntu1.20.04.1) ...",
        "Setting up libxslt1.1:amd64 (1.1.34-4) ...",
        "Setting up libjpeg8:amd64 (8c-2ubuntu8) ...",
        "Setting up libnginx-mod-mail (1.18.0-0ubuntu1.3) ...",
        "Setting up libnginx-mod-stream (1.18.0-0ubuntu1.3) ...",
        "Setting up libnginx-mod-http-xslt-filter (1.18.0-0ubuntu1.3) ...",
        "Setting up libtiff5:amd64 (4.1.0+git191117-2ubuntu0.20.04.3) ...",
        "Setting up libgd3:amd64 (2.2.5-5.2ubuntu2.1) ...",
        "Setting up libnginx-mod-http-image-filter (1.18.0-0ubuntu1.3) ...",
        "Setting up nginx-core (1.18.0-0ubuntu1.3) ...",
        "Setting up nginx (1.18.0-0ubuntu1.3) ...",
        "Processing triggers for ufw (0.36-6) ...",
        "Processing triggers for systemd (245.4-4ubuntu3) ...",
        "Processing triggers for man-db (2.9.1-1) ...",
        "Processing triggers for libc-bin (2.31-0ubuntu9) ..."
    ]
}
````

### Upload nginx config for virtual host

````bash
evgeni@legion:~/devOps/06_Ansible$ ansible -i inventory.yaml host9 -m ansible.builtin.copy -a "src=./index.html dest=/usr/share/nginx/html/index.html" -u root
host10 | CHANGED => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python3"
    },
    "changed": true,
    "checksum": "ebef6e8c9cbc26c3347c245fa9f72c467d3042fb",
    "dest": "/usr/share/nginx/html/index.html",
    "gid": 0,
    "group": "root",
    "md5sum": "645aec83abbab876894ed5d8d5237e76",
    "mode": "0644",
    "owner": "root",
    "size": 170,
    "src": "/root/.ansible/tmp/ansible-tmp-1660161167.056114-22575-152163096617126/source",
    "state": "file",
    "uid": 0
}
host9 | CHANGED => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/libexec/platform-python"
    },
    "changed": true,
    "checksum": "ebef6e8c9cbc26c3347c245fa9f72c467d3042fb",
    "dest": "/usr/share/nginx/html/index.html",
    "gid": 0,
    "group": "root",
    "md5sum": "645aec83abbab876894ed5d8d5237e76",
    "mode": "0644",
    "owner": "root",
    "size": 170,
    "src": "/root/.ansible/tmp/ansible-tmp-1660161166.9825232-22573-185921482948701/source",
    "state": "file",
    "uid": 0
}

evgeni@legion:~/devOps/06_Ansible$ ansible -i inventory.yaml host10 -m ansible.builtin.copy -a "src=./index.html dest=/var/www/html/index.nginx-debian.html" -u root
host10 | CHANGED => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python3"
    },
    "changed": true,
    "checksum": "ebef6e8c9cbc26c3347c245fa9f72c467d3042fb",
    "dest": "/var/www/html/index.nginx-debian.html",
    "gid": 0,
    "group": "root",
    "md5sum": "645aec83abbab876894ed5d8d5237e76",
    "mode": "0644",
    "owner": "root",
    "size": 170,
    "src": "/root/.ansible/tmp/ansible-tmp-1660161758.6719408-23806-210259355855585/source",
    "state": "file",
    "uid": 0
}
````

### Restart nginx service

````bash
evgeni@legion:~/devOps/06_Ansible$ ansible -i inventory.yaml -m ansible.builtin.service -a "name=nginx state=restarted" all_workers -u root
host10 | CHANGED => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python3"
    },
    "changed": true,
    "name": "nginx",
    "state": "started",
    "status": {
        "ActiveState": "active",
        "AllowedCPUs": "",
        "AllowedMemoryNodes": "",
        "BlockIOAccounting": "no",
        "BlockIOWeight": "[not set]",
        "CPUAccounting": "yes",
        "CPUAffinity": "",
        "CPUAffinityFromNUMA": "no",
        "CPUQuotaPerSecUSec": "infinity",
        "CPUQuotaPeriodUSec": "infinity",
        "CPUSchedulingPolicy": "0",
        "CPUSchedulingPriority": "0",
        "CPUSchedulingResetOnFork": "no",
        "CPUShares": "[not set]",
        "CPUUsageNSec": "28130000",
        "CPUWeight": "[not set]",
        "CleanResult": "success",
        "ControlGroup": "/system.slice/nginx.service",
        "ControlPID": "0",
        "DefaultMemoryLow": "0",
        "DefaultMemoryMin": "0",
        "Delegate": "no",
        "DevicePolicy": "auto",
        "EffectiveCPUs": "",
        "EffectiveMemoryNodes": "",
        "ExecMainCode": "0",
        "ExecMainExitTimestampMonotonic": "0",
        "ExecMainPID": "8008",
        "ExecMainStartTimestamp": "Wed 2022-08-10 19:40:29 UTC",
        "ExecMainStartTimestampMonotonic": "2165431513416",
        "ExecMainStatus": "0",
        "ExecReload": "{ path=/usr/sbin/nginx ; argv[]=/usr/sbin/nginx -g daemon on; master_process on; -s reload ; ignore_errors=no ; start_time=[n/a] ; stop_time=[n/a] ; pid=0 ; code=(null) ; status=0/0 }",
        "ExecReloadEx": "{ path=/usr/sbin/nginx ; argv[]=/usr/sbin/nginx -g daemon on; master_process on; -s reload ; flags= ; start_time=[n/a] ; stop_time=[n/a] ; pid=0 ; code=(null) ; status=0/0 }",
        "ExecStart": "{ path=/usr/sbin/nginx ; argv[]=/usr/sbin/nginx -g daemon on; master_process on; ; ignore_errors=no ; start_time=[n/a] ; stop_time=[n/a] ; pid=0 ; code=(null) ; status=0/0 }",
        "ExecStartEx": "{ path=/usr/sbin/nginx ; argv[]=/usr/sbin/nginx -g daemon on; master_process on; ; flags= ; start_time=[n/a] ; stop_time=[n/a] ; pid=0 ; code=(null) ; status=0/0 }",
        "ExecStartPre": "{ path=/usr/sbin/nginx ; argv[]=/usr/sbin/nginx -t -q -g daemon on; master_process on; ; ignore_errors=no ; start_time=[n/a] ; stop_time=[n/a] ; pid=0 ; code=(null) ; status=0/0 }",
        "ExecStartPreEx": "{ path=/usr/sbin/nginx ; argv[]=/usr/sbin/nginx -t -q -g daemon on; master_process on; ; flags= ; start_time=[n/a] ; stop_time=[n/a] ; pid=0 ; code=(null) ; status=0/0 }",
        "ExecStop": "{ path=/sbin/start-stop-daemon ; argv[]=/sbin/start-stop-daemon --quiet --stop --retry QUIT/5 --pidfile /run/nginx.pid ; ignore_errors=yes ; start_time=[n/a] ; stop_time=[n/a] ; pid=0 ; code=(null) ; status=0/0 }",
        "ExecStopEx": "{ path=/sbin/start-stop-daemon ; argv[]=/sbin/start-stop-daemon --quiet --stop --retry QUIT/5 --pidfile /run/nginx.pid ; flags=ignore-failure ; start_time=[n/a] ; stop_time=[n/a] ; pid=0 ; code=(null) ; status=0/0 }",
        "FileDescriptorStoreMax": "0",
        "GID": "[not set]",
        "GuessMainPID": "yes",
        "IOAccounting": "no",
        "IOReadBytes": "18446744073709551615",
        "IOReadOperations": "18446744073709551615",
        "IOSchedulingClass": "0",
        "IOSchedulingPriority": "0",
        "IOWeight": "[not set]",
        "IOWriteBytes": "18446744073709551615",
        "IOWriteOperations": "18446744073709551615",
        "IPAccounting": "no",
        "IPEgressBytes": "[no data]",
        "IPEgressPackets": "[no data]",
        "IPIngressBytes": "[no data]",
        "IPIngressPackets": "[no data]",
        "LimitAS": "infinity",
        "LimitASSoft": "infinity",
        "LimitCORE": "infinity",
        "LimitCORESoft": "0",
        "LimitCPU": "infinity",
        "LimitCPUSoft": "infinity",
        "LimitDATA": "infinity",
        "LimitDATASoft": "infinity",
        "LimitFSIZE": "infinity",
        "LimitFSIZESoft": "infinity",
        "LimitLOCKS": "infinity",
        "LimitLOCKSSoft": "infinity",
        "LimitMEMLOCK": "65536",
        "LimitMEMLOCKSoft": "65536",
        "LimitMSGQUEUE": "819200",
        "LimitMSGQUEUESoft": "819200",
        "LimitNICE": "0",
        "LimitNICESoft": "0",
        "LimitNOFILE": "524288",
        "LimitNOFILESoft": "1024",
        "LimitNPROC": "1030062",
        "LimitNPROCSoft": "1030062",
        "LimitRSS": "infinity",
        "LimitRSSSoft": "infinity",
        "LimitRTPRIO": "0",
        "LimitRTPRIOSoft": "0",
        "LimitRTTIME": "infinity",
        "LimitRTTIMESoft": "infinity",
        "LimitSIGPENDING": "1030062",
        "LimitSIGPENDINGSoft": "1030062",
        "LimitSTACK": "infinity",
        "LimitSTACKSoft": "8388608",
        "LogLevelMax": "-1",
        "LogRateLimitBurst": "0",
        "LogRateLimitIntervalUSec": "0",
        "MainPID": "8008",
        "MemoryAccounting": "yes",
        "MemoryCurrent": "6348800",
        "MemoryHigh": "infinity",
        "MemoryLimit": "infinity",
        "MemoryLow": "0",
        "MemoryMax": "infinity",
        "MemoryMin": "0",
        "MemorySwapMax": "infinity",
        "NFileDescriptorStore": "0",
        "NRestarts": "0",
        "NUMAMask": "",
        "NUMAPolicy": "n/a",
        "Nice": "0",
        "NonBlocking": "no",
        "NotifyAccess": "none",
        "OOMPolicy": "stop",
        "OOMScoreAdjust": "0",
        "PIDFile": "/run/nginx.pid",
        "ReloadResult": "success",
        "RemainAfterExit": "no",
        "Restart": "no",
        "RestartUSec": "100ms",
        "Result": "success",
        "RootDirectoryStartOnly": "no",
        "RuntimeMaxUSec": "infinity",
        "SecureBits": "0",
        "Slice": "system.slice",
        "StandardError": "inherit",
        "StandardInput": "null",
        "StandardInputData": "",
        "StandardOutput": "journal",
        "StartupBlockIOWeight": "[not set]",
        "StartupCPUShares": "[not set]",
        "StartupCPUWeight": "[not set]",
        "StartupIOWeight": "[not set]",
        "StatusErrno": "0",
        "SyslogFacility": "3",
        "SyslogLevel": "6",
        "SyslogLevelPrefix": "yes",
        "SyslogPriority": "30",
        "TTYReset": "no",
        "TTYVHangup": "no",
        "TTYVTDisallocate": "no",
        "TasksAccounting": "yes",
        "TasksCurrent": "3",
        "TasksMax": "309018",
        "TimeoutAbortUSec": "5s",
        "TimeoutStartUSec": "1min 30s",
        "TimeoutStopUSec": "5s",
        "TimerSlackNSec": "50000",
        "Type": "forking",
        "UID": "[not set]",
        "UMask": "0022",
        "WatchdogTimestampMonotonic": "0",
        "WatchdogUSec": "0"
    }
}
host9 | CHANGED => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/libexec/platform-python"
    },
    "changed": true,
    "name": "nginx",
    "state": "started",
    "status": {
        "ActiveEnterTimestampMonotonic": "0",
        "ActiveExitTimestampMonotonic": "0",
        "ActiveState": "inactive",
        "After": "systemd-tmpfiles-setup.service network.target basic.target nss-lookup.target systemd-journald.socket system.slice remote-fs.target sysinit.target tmp.mount -.mount",
        "AllowIsolate": "no",
        "AllowedCPUs": "",
        "AllowedMemoryNodes": "",
        "AmbientCapabilities": "",
        "AssertResult": "no",
        "AssertTimestampMonotonic": "0",
        "Before": "shutdown.target",
        "BlockIOAccounting": "no",
        "BlockIOWeight": "[not set]",
        "CPUAccounting": "no",
        "CPUAffinity": "",
        "CPUAffinityFromNUMA": "no",
        "CPUQuotaPerSecUSec": "infinity",
        "CPUQuotaPeriodUSec": "infinity",
        "CPUSchedulingPolicy": "0",
        "CPUSchedulingPriority": "0",
        "CPUSchedulingResetOnFork": "no",
        "CPUShares": "[not set]",
        "CPUUsageNSec": "[not set]",
        "CPUWeight": "[not set]",
        "CacheDirectoryMode": "0755",
        "CanFreeze": "yes",
        "CanIsolate": "no",
        "CanReload": "yes",
        "CanStart": "yes",
        "CanStop": "yes",
        "CapabilityBoundingSet": "cap_chown cap_dac_override cap_dac_read_search cap_fowner cap_fsetid cap_kill cap_setgid cap_setuid cap_setpcap cap_linux_immutable cap_net_bind_service cap_net_broadcast cap_net_admin cap_net_raw cap_ipc_lock cap_ipc_owner cap_sys_module cap_sys_rawio cap_sys_chroot cap_sys_ptrace cap_sys_pacct cap_sys_admin cap_sys_boot cap_sys_nice cap_sys_resource cap_sys_time cap_sys_tty_config cap_mknod cap_lease cap_audit_write cap_audit_control cap_setfcap cap_mac_override cap_mac_admin cap_syslog cap_wake_alarm cap_block_suspend cap_audit_read cap_perfmon cap_bpf",
        "CollectMode": "inactive",
        "ConditionResult": "no",
        "ConditionTimestampMonotonic": "0",
        "ConfigurationDirectoryMode": "0755",
        "Conflicts": "shutdown.target",
        "ControlPID": "0",
        "DefaultDependencies": "yes",
        "DefaultMemoryLow": "0",
        "DefaultMemoryMin": "0",
        "Delegate": "no",
        "Description": "The nginx HTTP and reverse proxy server",
        "DevicePolicy": "auto",
        "DynamicUser": "no",
        "EffectiveCPUs": "",
        "EffectiveMemoryNodes": "",
        "ExecMainCode": "0",
        "ExecMainExitTimestampMonotonic": "0",
        "ExecMainPID": "0",
        "ExecMainStartTimestampMonotonic": "0",
        "ExecMainStatus": "0",
        "ExecReload": "{ path=/bin/kill ; argv[]=/bin/kill -s HUP $MAINPID ; ignore_errors=no ; start_time=[n/a] ; stop_time=[n/a] ; pid=0 ; code=(null) ; status=0/0 }",
        "ExecStart": "{ path=/usr/sbin/nginx ; argv[]=/usr/sbin/nginx ; ignore_errors=no ; start_time=[n/a] ; stop_time=[n/a] ; pid=0 ; code=(null) ; status=0/0 }",
        "ExecStartPre": "{ path=/usr/sbin/nginx ; argv[]=/usr/sbin/nginx -t ; ignore_errors=no ; start_time=[n/a] ; stop_time=[n/a] ; pid=0 ; code=(null) ; status=0/0 }",
        "FailureAction": "none",
        "FileDescriptorStoreMax": "0",
        "FragmentPath": "/usr/lib/systemd/system/nginx.service",
        "FreezerState": "running",
        "GID": "[not set]",
        "GuessMainPID": "yes",
        "IOAccounting": "no",
        "IOSchedulingClass": "0",
        "IOSchedulingPriority": "0",
        "IOWeight": "[not set]",
        "IPAccounting": "no",
        "IPEgressBytes": "18446744073709551615",
        "IPEgressPackets": "18446744073709551615",
        "IPIngressBytes": "18446744073709551615",
        "IPIngressPackets": "18446744073709551615",
        "Id": "nginx.service",
        "IgnoreOnIsolate": "no",
        "IgnoreSIGPIPE": "yes",
        "InactiveEnterTimestampMonotonic": "0",
        "InactiveExitTimestampMonotonic": "0",
        "JobRunningTimeoutUSec": "infinity",
        "JobTimeoutAction": "none",
        "JobTimeoutUSec": "infinity",
        "KeyringMode": "private",
        "KillMode": "mixed",
        "KillSignal": "3",
        "LimitAS": "infinity",
        "LimitASSoft": "infinity",
        "LimitCORE": "infinity",
        "LimitCORESoft": "0",
        "LimitCPU": "infinity",
        "LimitCPUSoft": "infinity",
        "LimitDATA": "infinity",
        "LimitDATASoft": "infinity",
        "LimitFSIZE": "infinity",
        "LimitFSIZESoft": "infinity",
        "LimitLOCKS": "infinity",
        "LimitLOCKSSoft": "infinity",
        "LimitMEMLOCK": "65536",
        "LimitMEMLOCKSoft": "65536",
        "LimitMSGQUEUE": "819200",
        "LimitMSGQUEUESoft": "819200",
        "LimitNICE": "0",
        "LimitNICESoft": "0",
        "LimitNOFILE": "524288",
        "LimitNOFILESoft": "1024",
        "LimitNPROC": "1030062",
        "LimitNPROCSoft": "1030062",
        "LimitRSS": "infinity",
        "LimitRSSSoft": "infinity",
        "LimitRTPRIO": "0",
        "LimitRTPRIOSoft": "0",
        "LimitRTTIME": "infinity",
        "LimitRTTIMESoft": "infinity",
        "LimitSIGPENDING": "1030062",
        "LimitSIGPENDINGSoft": "1030062",
        "LimitSTACK": "infinity",
        "LimitSTACKSoft": "8388608",
        "LoadState": "loaded",
        "LockPersonality": "no",
        "LogLevelMax": "-1",
        "LogRateLimitBurst": "0",
        "LogRateLimitIntervalUSec": "0",
        "LogsDirectoryMode": "0755",
        "MainPID": "0",
        "MemoryAccounting": "yes",
        "MemoryCurrent": "[not set]",
        "MemoryDenyWriteExecute": "no",
        "MemoryHigh": "infinity",
        "MemoryLimit": "infinity",
        "MemoryLow": "0",
        "MemoryMax": "infinity",
        "MemoryMin": "0",
        "MemorySwapMax": "infinity",
        "MountAPIVFS": "no",
        "MountFlags": "",
        "NFileDescriptorStore": "0",
        "NRestarts": "0",
        "NUMAMask": "",
        "NUMAPolicy": "n/a",
        "Names": "nginx.service",
        "NeedDaemonReload": "no",
        "Nice": "0",
        "NoNewPrivileges": "no",
        "NonBlocking": "no",
        "NotifyAccess": "none",
        "OOMScoreAdjust": "0",
        "OnFailureJobMode": "replace",
        "PIDFile": "/run/nginx.pid",
        "PermissionsStartOnly": "no",
        "Perpetual": "no",
        "PrivateDevices": "no",
        "PrivateMounts": "no",
        "PrivateNetwork": "no",
        "PrivateTmp": "yes",
        "PrivateUsers": "no",
        "ProtectControlGroups": "no",
        "ProtectHome": "no",
        "ProtectKernelModules": "no",
        "ProtectKernelTunables": "no",
        "ProtectSystem": "no",
        "RefuseManualStart": "no",
        "RefuseManualStop": "no",
        "RemainAfterExit": "no",
        "RemoveIPC": "no",
        "Requires": "system.slice sysinit.target",
        "RequiresMountsFor": "/var/tmp",
        "Restart": "no",
        "RestartUSec": "100ms",
        "RestrictNamespaces": "no",
        "RestrictRealtime": "no",
        "RestrictSUIDSGID": "no",
        "Result": "success",
        "RootDirectoryStartOnly": "no",
        "RuntimeDirectoryMode": "0755",
        "RuntimeDirectoryPreserve": "no",
        "RuntimeMaxUSec": "infinity",
        "SameProcessGroup": "no",
        "SecureBits": "0",
        "SendSIGHUP": "no",
        "SendSIGKILL": "yes",
        "Slice": "system.slice",
        "StandardError": "inherit",
        "StandardInput": "null",
        "StandardInputData": "",
        "StandardOutput": "journal",
        "StartLimitAction": "none",
        "StartLimitBurst": "5",
        "StartLimitIntervalUSec": "10s",
        "StartupBlockIOWeight": "[not set]",
        "StartupCPUShares": "[not set]",
        "StartupCPUWeight": "[not set]",
        "StartupIOWeight": "[not set]",
        "StateChangeTimestampMonotonic": "0",
        "StateDirectoryMode": "0755",
        "StatusErrno": "0",
        "StopWhenUnneeded": "no",
        "SubState": "dead",
        "SuccessAction": "none",
        "SyslogFacility": "3",
        "SyslogLevel": "6",
        "SyslogLevelPrefix": "yes",
        "SyslogPriority": "30",
        "SystemCallErrorNumber": "0",
        "TTYReset": "no",
        "TTYVHangup": "no",
        "TTYVTDisallocate": "no",
        "TasksAccounting": "yes",
        "TasksCurrent": "[not set]",
        "TasksMax": "1648100",
        "TimeoutStartUSec": "1min 30s",
        "TimeoutStopUSec": "5s",
        "TimerSlackNSec": "50000",
        "Transient": "no",
        "Type": "forking",
        "UID": "[not set]",
        "UMask": "0022",
        "UnitFilePreset": "disabled",
        "UnitFileState": "disabled",
        "UtmpMode": "init",
        "WatchdogTimestampMonotonic": "0",
        "WatchdogUSec": "0"
    }
}
````

### Test it

````bash
evgeni@legion:~/devOps/06_Ansible$ ansible -i inventory.yaml -m ansible.builtin.uri -a "url=http://127.0.0.1 return_content=yes" all_workers -u root
host10 | SUCCESS => {
    "accept_ranges": "bytes",
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python3"
    },
    "changed": false,
    "connection": "close",
    "content": "<!DOCTYPE html>\n        <head>\n                <meta charset=\"utf-8\">\n        </head>\n        <body>\n                <div> Evgeni Ermakov </div>\n        </body>\n</html>\n\n",
    "content_length": "170",
    "content_type": "text/html",
    "cookies": {},
    "cookies_string": "",
    "date": "Wed, 10 Aug 2022 20:03:27 GMT",
    "elapsed": 0,
    "etag": "\"62f40edf-aa\"",
    "last_modified": "Wed, 10 Aug 2022 20:02:39 GMT",
    "msg": "OK (170 bytes)",
    "redirected": false,
    "server": "nginx/1.18.0 (Ubuntu)",
    "status": 200,
    "url": "http://127.0.0.1"
}
host9 | SUCCESS => {
    "accept_ranges": "bytes",
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/libexec/platform-python"
    },
    "changed": false,
    "connection": "close",
    "content": "<!DOCTYPE html>\n        <head>\n                <meta charset=\"utf-8\">\n        </head>\n        <body>\n                <div> Evgeni Ermakov </div>\n        </body>\n</html>\n\n",
    "content_length": "170",
    "content_type": "text/html",
    "cookies": {},
    "cookies_string": "",
    "date": "Wed, 10 Aug 2022 20:03:27 GMT",
    "elapsed": 0,
    "etag": "\"62f40c8f-aa\"",
    "last_modified": "Wed, 10 Aug 2022 19:52:47 GMT",
    "msg": "OK (170 bytes)",
    "redirected": false,
    "server": "nginx/1.14.1",
    "status": 200,
    "url": "http://127.0.0.1"
}
````

## Ansible playbook

````bash
evgeni@legion:~/devOps/06_Ansible$ ansible-playbook -i inventory.yaml playbook.yaml -u root

PLAY [all_workers] ************************************************************************************************************************************************************************************************

TASK [Gathering Facts] ********************************************************************************************************************************************************************************************
Thursday 11 August 2022  17:41:04 +0300 (0:00:00.008)       0:00:00.008 ******* 
ok: [host10]
ok: [host9]

TASK [OS/version] *************************************************************************************************************************************************************************************************
Thursday 11 August 2022  17:41:26 +0300 (0:00:21.802)       0:00:21.810 ******* 
ok: [host9] => {
    "msg": "OS: CentOS | OS Version: 8.5 "
}
ok: [host10] => {
    "msg": "OS: Ubuntu | OS Version: 20.04 "
}

TASK [Mount point/capacity/used] **********************************************************************************************************************************************************************************
Thursday 11 August 2022  17:41:26 +0300 (0:00:00.045)       0:00:21.856 ******* 
ok: [host9] => (item={'mount': '/', 'device': '/dev/loop8', 'fstype': 'ext4', 'options': 'rw,relatime', 'size_total': 20957446144, 'size_available': 18929967104, 'block_size': 4096, 'block_total': 5116564, 'block_available': 4621574, 'block_used': 494990, 'inode_total': 1310720, 'inode_available': 1284469, 'inode_used': 26251, 'uuid': 'N/A'}) => {
    "msg": "Mount point: / | Total size: 20957 MB | Size available: 18929 MB | Used: 2028 MB"
}
ok: [host10] => (item={'mount': '/', 'device': '/dev/loop9', 'fstype': 'ext4', 'options': 'rw,relatime', 'size_total': 20957446144, 'size_available': 18770526208, 'block_size': 4096, 'block_total': 5116564, 'block_available': 4582648, 'block_used': 533916, 'inode_total': 1310720, 'inode_available': 1282544, 'inode_used': 28176, 'uuid': 'N/A'}) => {
    "msg": "Mount point: / | Total size: 20957 MB | Size available: 18770 MB | Used: 2187 MB"
}

TASK [RAM/capacity/free] ******************************************************************************************************************************************************************************************
Thursday 11 August 2022  17:41:26 +0300 (0:00:00.065)       0:00:21.922 ******* 
ok: [host9] => {
    "msg": "RAM total: 2048 MB | RAM FREE: 1582 MB"
}
ok: [host10] => {
    "msg": "RAM total: 2048 MB | RAM FREE: 1450 MB"
}

PLAY RECAP ********************************************************************************************************************************************************************************************************
host10                     : ok=4    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
host9                      : ok=4    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Thursday 11 August 2022  17:41:26 +0300 (0:00:00.080)       0:00:22.002 ******* 
=============================================================================== 
Gathering Facts ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 21.80s
RAM/capacity/free ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 0.08s
Mount point/capacity/used ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 0.07s
OS/version ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 0.05s
Playbook run took 0 days, 0 hours, 0 minutes, 22 seconds
````
