# 07.Ansible.Cruise Homework

## Playbook with role(s) to install Nginx server

```bash
it-academy.by/07.Ansible.Cruise [ ansible-playbook -i inv.yaml nginx.yaml                                                                                        master * ] 6:32 

PLAY [work_hosts] ****************************************************************************************************************************************************************

TASK [Gathering Facts] ***********************************************************************************************************************************************************
Friday 09 July 2021  18:32:50 +0300 (0:00:00.064)       0:00:00.064 *********** 
ok: [work_01]
ok: [work_02]

TASK [nginx : Install Nginx package Ubuntu] **************************************************************************************************************************************
Friday 09 July 2021  18:32:53 +0300 (0:00:02.568)       0:00:02.632 *********** 
skipping: [work_01]
[WARNING]: Could not find aptitude. Using apt-get instead

ok: [work_02]

TASK [nginx : Enable & Start nginx service] **************************************************************************************************************************************
Friday 09 July 2021  18:32:55 +0300 (0:00:02.699)       0:00:05.332 *********** 
skipping: [work_01]
ok: [work_02]

TASK [nginx : Install epel-release] **********************************************************************************************************************************************
Friday 09 July 2021  18:32:57 +0300 (0:00:01.557)       0:00:06.889 *********** 
skipping: [work_02]
ok: [work_01]

TASK [nginx : Install Nginx package CentOS] **************************************************************************************************************************************
Friday 09 July 2021  18:32:59 +0300 (0:00:01.761)       0:00:08.651 *********** 
skipping: [work_02]
ok: [work_01]

TASK [nginx : Enable & Start nginx service] **************************************************************************************************************************************
Friday 09 July 2021  18:33:00 +0300 (0:00:01.199)       0:00:09.850 *********** 
skipping: [work_02]
ok: [work_01]

TASK [nginx : Add http port to firewall] *****************************************************************************************************************************************
Friday 09 July 2021  18:33:01 +0300 (0:00:00.926)       0:00:10.776 *********** 
skipping: [work_02]
ok: [work_01]

TASK [nginx : Restart firewalld service] *****************************************************************************************************************************************
Friday 09 July 2021  18:33:02 +0300 (0:00:01.425)       0:00:12.202 *********** 
skipping: [work_02]
changed: [work_01]

TASK [nginx : Copy nginx config to virtual hosts] ********************************************************************************************************************************
Friday 09 July 2021  18:33:03 +0300 (0:00:01.129)       0:00:13.331 *********** 
ok: [work_02]
ok: [work_01]

TASK [nginx : Copy first page] ***************************************************************************************************************************************************
Friday 09 July 2021  18:33:05 +0300 (0:00:01.859)       0:00:15.191 *********** 
ok: [work_01]
ok: [work_02]

TASK [nginx : Check connection to Localhost] *************************************************************************************************************************************
Friday 09 July 2021  18:33:07 +0300 (0:00:01.560)       0:00:16.752 *********** 
ok: [work_02]
ok: [work_01]

TASK [nginx : Create hosts entry] ************************************************************************************************************************************************
Friday 09 July 2021  18:33:08 +0300 (0:00:01.010)       0:00:17.762 *********** 
ok: [work_02]
ok: [work_01]

TASK [nginx : Check template] ****************************************************************************************************************************************************
Friday 09 July 2021  18:33:09 +0300 (0:00:01.284)       0:00:19.047 *********** 
ok: [work_02]
ok: [work_01]

TASK [nginx : print out] *********************************************************************************************************************************************************
Friday 09 July 2021  18:33:11 +0300 (0:00:02.065)       0:00:21.113 *********** 
ok: [work_01] => {
    "msg": [
        "### Ansible managed",
        "127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4",
        "::1         localhost localhost.localdomain localhost6 localhost6.localdomain6",
        "",
        "192.168.202.17   local-cent.site",
        "192.168.202.18   local-deb.site"
    ]
}
ok: [work_02] => {
    "msg": [
        "### Ansible managed",
        "127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4",
        "::1         localhost localhost.localdomain localhost6 localhost6.localdomain6",
        "",
        "192.168.202.17   local-cent.site",
        "192.168.202.18   local-deb.site"
    ]
}

TASK [nginx : print out] *********************************************************************************************************************************************************
Friday 09 July 2021  18:33:12 +0300 (0:00:00.278)       0:00:21.392 *********** 
ok: [work_01] => {
    "msg": {
        "changed": false,
        "cmd": "cat /etc/hosts\n",
        "delta": "0:00:01.004187",
        "end": "2021-07-09 15:33:11.589454",
        "failed": false,
        "rc": 0,
        "start": "2021-07-09 15:33:10.585267",
        "stderr": "",
        "stderr_lines": [],
        "stdout": "### Ansible managed\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n\n192.168.202.17   local-cent.site\n192.168.202.18   local-deb.site",
        "stdout_lines": [
            "### Ansible managed",
            "127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4",
            "::1         localhost localhost.localdomain localhost6 localhost6.localdomain6",
            "",
            "192.168.202.17   local-cent.site",
            "192.168.202.18   local-deb.site"
        ]
    }
}
ok: [work_02] => {
    "msg": {
        "changed": false,
        "cmd": "cat /etc/hosts\n",
        "delta": "0:00:00.002498",
        "end": "2021-07-09 15:33:10.562932",
        "failed": false,
        "rc": 0,
        "start": "2021-07-09 15:33:10.560434",
        "stderr": "",
        "stderr_lines": [],
        "stdout": "### Ansible managed\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n\n192.168.202.17   local-cent.site\n192.168.202.18   local-deb.site",
        "stdout_lines": [
            "### Ansible managed",
            "127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4",
            "::1         localhost localhost.localdomain localhost6 localhost6.localdomain6",
            "",
            "192.168.202.17   local-cent.site",
            "192.168.202.18   local-deb.site"
        ]
    }
}

TASK [nginx : Check content to the sites] ****************************************************************************************************************************************
Friday 09 July 2021  18:33:12 +0300 (0:00:00.258)       0:00:21.650 *********** 
ok: [work_02] => (item={'name': 'local-cent.site', 'ip': '192.168.202.17'})
ok: [work_01] => (item={'name': 'local-cent.site', 'ip': '192.168.202.17'})
ok: [work_02] => (item={'name': 'local-deb.site', 'ip': '192.168.202.18'})
ok: [work_01] => (item={'name': 'local-deb.site', 'ip': '192.168.202.18'})

TASK [nginx : print out] *********************************************************************************************************************************************************
Friday 09 July 2021  18:33:14 +0300 (0:00:02.185)       0:00:23.836 *********** 
ok: [work_01] => {
    "msg": {
        "changed": false,
        "msg": "All items completed",
        "results": [
            {
                "accept_ranges": "bytes",
                "ansible_loop_var": "item",
                "changed": false,
                "connection": "close",
                "content": "<h1>Hello World!</h1>\n",
                "content_length": "22",
                "content_type": "text/html",
                "cookies": {},
                "cookies_string": "",
                "date": "Fri, 09 Jul 2021 15:33:13 GMT",
                "elapsed": 0,
                "etag": "\"60e6d43b-16\"",
                "failed": false,
                "failed_when_result": false,
                "invocation": {
                    "module_args": {
                        "attributes": null,
                        "backup": null,
                        "body": null,
                        "body_format": "raw",
                        "client_cert": null,
                        "client_key": null,
                        "content": null,
                        "creates": null,
                        "delimiter": null,
                        "dest": null,
                        "directory_mode": null,
                        "follow": false,
                        "follow_redirects": "safe",
                        "force": false,
                        "force_basic_auth": false,
                        "group": null,
                        "headers": {},
                        "http_agent": "ansible-httpget",
                        "method": "GET",
                        "mode": null,
                        "owner": null,
                        "regexp": null,
                        "remote_src": null,
                        "removes": null,
                        "return_content": true,
                        "selevel": null,
                        "serole": null,
                        "setype": null,
                        "seuser": null,
                        "src": null,
                        "status_code": [
                            200
                        ],
                        "timeout": 30,
                        "unix_socket": null,
                        "unsafe_writes": null,
                        "url": "http://local-cent.site",
                        "url_password": null,
                        "url_username": null,
                        "use_proxy": true,
                        "validate_certs": true
                    }
                },
                "item": {
                    "ip": "192.168.202.17",
                    "name": "local-cent.site"
                },
                "last_modified": "Thu, 08 Jul 2021 10:32:27 GMT",
                "msg": "OK (22 bytes)",
                "redirected": false,
                "server": "nginx/1.20.1",
                "status": 200,
                "url": "http://local-cent.site"
            },
            {
                "accept_ranges": "bytes",
                "ansible_loop_var": "item",
                "changed": false,
                "connection": "close",
                "content": "<h1>Hello World!</h1>\n",
                "content_length": "22",
                "content_type": "text/html",
                "cookies": {},
                "cookies_string": "",
                "date": "Fri, 09 Jul 2021 15:33:14 GMT",
                "elapsed": 0,
                "etag": "\"60e6d43b-16\"",
                "failed": false,
                "failed_when_result": false,
                "invocation": {
                    "module_args": {
                        "attributes": null,
                        "backup": null,
                        "body": null,
                        "body_format": "raw",
                        "client_cert": null,
                        "client_key": null,
                        "content": null,
                        "creates": null,
                        "delimiter": null,
                        "dest": null,
                        "directory_mode": null,
                        "follow": false,
                        "follow_redirects": "safe",
                        "force": false,
                        "force_basic_auth": false,
                        "group": null,
                        "headers": {},
                        "http_agent": "ansible-httpget",
                        "method": "GET",
                        "mode": null,
                        "owner": null,
                        "regexp": null,
                        "remote_src": null,
                        "removes": null,
                        "return_content": true,
                        "selevel": null,
                        "serole": null,
                        "setype": null,
                        "seuser": null,
                        "src": null,
                        "status_code": [
                            200
                        ],
                        "timeout": 30,
                        "unix_socket": null,
                        "unsafe_writes": null,
                        "url": "http://local-deb.site",
                        "url_password": null,
                        "url_username": null,
                        "use_proxy": true,
                        "validate_certs": true
                    }
                },
                "item": {
                    "ip": "192.168.202.18",
                    "name": "local-deb.site"
                },
                "last_modified": "Thu, 08 Jul 2021 10:32:27 GMT",
                "msg": "OK (22 bytes)",
                "redirected": false,
                "server": "nginx/1.14.0 (Ubuntu)",
                "status": 200,
                "url": "http://local-deb.site"
            }
        ]
    }
}
ok: [work_02] => {
    "msg": {
        "changed": false,
        "msg": "All items completed",
        "results": [
            {
                "accept_ranges": "bytes",
                "ansible_loop_var": "item",
                "changed": false,
                "connection": "close",
                "content": "<h1>Hello World!</h1>\n",
                "content_length": "22",
                "content_type": "text/html",
                "cookies": {},
                "cookies_string": "",
                "date": "Fri, 09 Jul 2021 15:33:13 GMT",
                "elapsed": 0,
                "etag": "\"60e6d43b-16\"",
                "failed": false,
                "failed_when_result": false,
                "invocation": {
                    "module_args": {
                        "attributes": null,
                        "backup": null,
                        "body": null,
                        "body_format": "raw",
                        "client_cert": null,
                        "client_key": null,
                        "content": null,
                        "creates": null,
                        "delimiter": null,
                        "dest": null,
                        "directory_mode": null,
                        "follow": false,
                        "follow_redirects": "safe",
                        "force": false,
                        "force_basic_auth": false,
                        "group": null,
                        "headers": {},
                        "http_agent": "ansible-httpget",
                        "method": "GET",
                        "mode": null,
                        "owner": null,
                        "regexp": null,
                        "remote_src": null,
                        "removes": null,
                        "return_content": true,
                        "selevel": null,
                        "serole": null,
                        "setype": null,
                        "seuser": null,
                        "src": null,
                        "status_code": [
                            200
                        ],
                        "timeout": 30,
                        "unix_socket": null,
                        "unsafe_writes": null,
                        "url": "http://local-cent.site",
                        "url_password": null,
                        "url_username": null,
                        "use_proxy": true,
                        "validate_certs": true
                    }
                },
                "item": {
                    "ip": "192.168.202.17",
                    "name": "local-cent.site"
                },
                "last_modified": "Thu, 08 Jul 2021 10:32:27 GMT",
                "msg": "OK (22 bytes)",
                "redirected": false,
                "server": "nginx/1.20.1",
                "status": 200,
                "url": "http://local-cent.site"
            },
            {
                "accept_ranges": "bytes",
                "ansible_loop_var": "item",
                "changed": false,
                "connection": "close",
                "content": "<h1>Hello World!</h1>\n",
                "content_length": "22",
                "content_type": "text/html",
                "cookies": {},
                "cookies_string": "",
                "date": "Fri, 09 Jul 2021 15:33:14 GMT",
                "elapsed": 0,
                "etag": "\"60e6d43b-16\"",
                "failed": false,
                "failed_when_result": false,
                "invocation": {
                    "module_args": {
                        "attributes": null,
                        "backup": null,
                        "body": null,
                        "body_format": "raw",
                        "client_cert": null,
                        "client_key": null,
                        "content": null,
                        "creates": null,
                        "delimiter": null,
                        "dest": null,
                        "directory_mode": null,
                        "follow": false,
                        "follow_redirects": "safe",
                        "force": false,
                        "force_basic_auth": false,
                        "group": null,
                        "headers": {},
                        "http_agent": "ansible-httpget",
                        "method": "GET",
                        "mode": null,
                        "owner": null,
                        "regexp": null,
                        "remote_src": null,
                        "removes": null,
                        "return_content": true,
                        "selevel": null,
                        "serole": null,
                        "setype": null,
                        "seuser": null,
                        "src": null,
                        "status_code": [
                            200
                        ],
                        "timeout": 30,
                        "unix_socket": null,
                        "unsafe_writes": null,
                        "url": "http://local-deb.site",
                        "url_password": null,
                        "url_username": null,
                        "use_proxy": true,
                        "validate_certs": true
                    }
                },
                "item": {
                    "ip": "192.168.202.18",
                    "name": "local-deb.site"
                },
                "last_modified": "Thu, 08 Jul 2021 10:32:27 GMT",
                "msg": "OK (22 bytes)",
                "redirected": false,
                "server": "nginx/1.14.0 (Ubuntu)",
                "status": 200,
                "url": "http://local-deb.site"
            }
        ]
    }
}

PLAY RECAP ***********************************************************************************************************************************************************************
work_01                    : ok=15   changed=1    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0   
work_02                    : ok=12   changed=0    unreachable=0    failed=0    skipped=5    rescued=0    ignored=0   

Friday 09 July 2021  18:33:14 +0300 (0:00:00.223)       0:00:24.059 *********** 
=============================================================================== 
nginx : Install Nginx package Ubuntu -------------------------------------------------------------------------------------------------------------------------------------- 2.70s
Gathering Facts ----------------------------------------------------------------------------------------------------------------------------------------------------------- 2.57s
nginx : Check content to the sites ---------------------------------------------------------------------------------------------------------------------------------------- 2.19s
nginx : Check template ---------------------------------------------------------------------------------------------------------------------------------------------------- 2.07s
nginx : Copy nginx config to virtual hosts -------------------------------------------------------------------------------------------------------------------------------- 1.86s
nginx : Install epel-release ---------------------------------------------------------------------------------------------------------------------------------------------- 1.76s
nginx : Copy first page --------------------------------------------------------------------------------------------------------------------------------------------------- 1.56s
nginx : Enable & Start nginx service -------------------------------------------------------------------------------------------------------------------------------------- 1.56s
nginx : Add http port to firewall ----------------------------------------------------------------------------------------------------------------------------------------- 1.43s
nginx : Create hosts entry ------------------------------------------------------------------------------------------------------------------------------------------------ 1.28s
nginx : Install Nginx package CentOS -------------------------------------------------------------------------------------------------------------------------------------- 1.20s
nginx : Restart firewalld service ----------------------------------------------------------------------------------------------------------------------------------------- 1.13s
nginx : Check connection to Localhost ------------------------------------------------------------------------------------------------------------------------------------- 1.01s
nginx : Enable & Start nginx service -------------------------------------------------------------------------------------------------------------------------------------- 0.93s
nginx : print out --------------------------------------------------------------------------------------------------------------------------------------------------------- 0.28s
nginx : print out --------------------------------------------------------------------------------------------------------------------------------------------------------- 0.26s
nginx : print out --------------------------------------------------------------------------------------------------------------------------------------------------------- 0.22s
Playbook run took 0 days, 0 hours, 0 minutes, 24 seconds
```

## Molecule test for testing role

```bash
roles/test [ molecule test -d docker                                                                                                                                                   

INFO     default scenario test matrix: dependency, lint, cleanup, destroy, syntax, create, prepare, converge, idempotence, side_effect, verify, cleanup, destroy
INFO     Performing prerun...
WARNING  Computed fully qualified role name of test does not follow current galaxy requirements.
Please edit meta/main.yml and assure we can correctly determine full role name:

galaxy_info:
role_name: my_name  # if absent directory name hosting role is used instead
namespace: my_galaxy_namespace  # if absent, author is used instead

Namespace: https://galaxy.ansible.com/docs/contributing/namespaces.html#galaxy-namespace-limitations
Role: https://galaxy.ansible.com/docs/contributing/creating_role.html#role-names

As an alternative, you can add 'role-name' to either skip_list or warn_list.

INFO     Using /home/igor/.cache/ansible-lint/a309db/roles/test symlink to current repository in order to enable Ansible to find the role using its expected full name.
INFO     Added ANSIBLE_ROLES_PATH=~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles:/home/igor/.cache/ansible-lint/a309db/roles
INFO     Running default > dependency
WARNING  Skipping, missing the requirements file.
WARNING  Skipping, missing the requirements file.
INFO     Running default > lint
INFO     Lint is disabled.
INFO     Running default > cleanup
WARNING  Skipping, cleanup playbook not configured.
INFO     Running default > destroy
INFO     Sanity checks: 'docker'

PLAY [Destroy] *****************************************************************************************************************************************************************************************

TASK [Destroy molecule instance(s)] ********************************************************************************************************************************************************************
changed: [localhost] => (item=instance_cent)
changed: [localhost] => (item=instance_deb)
changed: [localhost] => (item=instance_alpine)

TASK [Wait for instance(s) deletion to complete] *******************************************************************************************************************************************************
ok: [localhost] => (item={'started': 1, 'finished': 0, 'ansible_job_id': '137272692801.52695', 'results_file': '/home/igor/.ansible_async/137272692801.52695', 'changed': True, 'failed': False, 'item': {'image': 'docker.io/pycontribs/centos:7', 'name': 'instance_cent', 'pre_build_image': True}, 'ansible_loop_var': 'item'})
ok: [localhost] => (item={'started': 1, 'finished': 0, 'ansible_job_id': '518654033385.52719', 'results_file': '/home/igor/.ansible_async/518654033385.52719', 'changed': True, 'failed': False, 'item': {'image': 'docker.io/pycontribs/debian:latest', 'name': 'instance_deb', 'pre_build_image': True}, 'ansible_loop_var': 'item'})
ok: [localhost] => (item={'started': 1, 'finished': 0, 'ansible_job_id': '762132432928.52742', 'results_file': '/home/igor/.ansible_async/762132432928.52742', 'changed': True, 'failed': False, 'item': {'image': 'docker.io/pycontribs/alpine:latest', 'name': 'instance_alpine', 'pre_build_image': True}, 'ansible_loop_var': 'item'})

TASK [Delete docker network(s)] ************************************************************************************************************************************************************************

PLAY RECAP *********************************************************************************************************************************************************************************************
localhost                  : ok=2    changed=1    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0

INFO     Running default > syntax

playbook: /home/igor/Documents/it-academy.by/07.Ansible.Cruise/roles/test/molecule/default/converge.yml
INFO     Running default > create

PLAY [Create] ******************************************************************************************************************************************************************************************

TASK [Log into a Docker registry] **********************************************************************************************************************************************************************
skipping: [localhost] => (item={'image': 'docker.io/pycontribs/centos:7', 'name': 'instance_cent', 'pre_build_image': True}) 
skipping: [localhost] => (item={'image': 'docker.io/pycontribs/debian:latest', 'name': 'instance_deb', 'pre_build_image': True}) 
skipping: [localhost] => (item={'image': 'docker.io/pycontribs/alpine:latest', 'name': 'instance_alpine', 'pre_build_image': True}) 

TASK [Check presence of custom Dockerfiles] ************************************************************************************************************************************************************
ok: [localhost] => (item={'image': 'docker.io/pycontribs/centos:7', 'name': 'instance_cent', 'pre_build_image': True})
ok: [localhost] => (item={'image': 'docker.io/pycontribs/debian:latest', 'name': 'instance_deb', 'pre_build_image': True})
ok: [localhost] => (item={'image': 'docker.io/pycontribs/alpine:latest', 'name': 'instance_alpine', 'pre_build_image': True})

TASK [Create Dockerfiles from image names] *************************************************************************************************************************************************************
skipping: [localhost] => (item={'image': 'docker.io/pycontribs/centos:7', 'name': 'instance_cent', 'pre_build_image': True}) 
skipping: [localhost] => (item={'image': 'docker.io/pycontribs/debian:latest', 'name': 'instance_deb', 'pre_build_image': True}) 
skipping: [localhost] => (item={'image': 'docker.io/pycontribs/alpine:latest', 'name': 'instance_alpine', 'pre_build_image': True}) 

TASK [Discover local Docker images] ********************************************************************************************************************************************************************
ok: [localhost] => (item={'changed': False, 'skipped': True, 'skip_reason': 'Conditional result was False', 'item': {'image': 'docker.io/pycontribs/centos:7', 'name': 'instance_cent', 'pre_build_image': True}, 'ansible_loop_var': 'item', 'i': 0, 'ansible_index_var': 'i'})
ok: [localhost] => (item={'changed': False, 'skipped': True, 'skip_reason': 'Conditional result was False', 'item': {'image': 'docker.io/pycontribs/debian:latest', 'name': 'instance_deb', 'pre_build_image': True}, 'ansible_loop_var': 'item', 'i': 1, 'ansible_index_var': 'i'})
ok: [localhost] => (item={'changed': False, 'skipped': True, 'skip_reason': 'Conditional result was False', 'item': {'image': 'docker.io/pycontribs/alpine:latest', 'name': 'instance_alpine', 'pre_build_image': True}, 'ansible_loop_var': 'item', 'i': 2, 'ansible_index_var': 'i'})

TASK [Build an Ansible compatible image (new)] *********************************************************************************************************************************************************
skipping: [localhost] => (item=molecule_local/docker.io/pycontribs/centos:7) 
skipping: [localhost] => (item=molecule_local/docker.io/pycontribs/debian:latest) 
skipping: [localhost] => (item=molecule_local/docker.io/pycontribs/alpine:latest) 

TASK [Create docker network(s)] ************************************************************************************************************************************************************************

TASK [Determine the CMD directives] ********************************************************************************************************************************************************************
ok: [localhost] => (item={'image': 'docker.io/pycontribs/centos:7', 'name': 'instance_cent', 'pre_build_image': True})
ok: [localhost] => (item={'image': 'docker.io/pycontribs/debian:latest', 'name': 'instance_deb', 'pre_build_image': True})
ok: [localhost] => (item={'image': 'docker.io/pycontribs/alpine:latest', 'name': 'instance_alpine', 'pre_build_image': True})

TASK [Create molecule instance(s)] *********************************************************************************************************************************************************************
changed: [localhost] => (item=instance_cent)
changed: [localhost] => (item=instance_deb)
changed: [localhost] => (item=instance_alpine)

TASK [Wait for instance(s) creation to complete] *******************************************************************************************************************************************************
FAILED - RETRYING: Wait for instance(s) creation to complete (300 retries left).
changed: [localhost] => (item={'started': 1, 'finished': 0, 'ansible_job_id': '757941224726.53076', 'results_file': '/home/igor/.ansible_async/757941224726.53076', 'changed': True, 'failed': False, 'item': {'image': 'docker.io/pycontribs/centos:7', 'name': 'instance_cent', 'pre_build_image': True}, 'ansible_loop_var': 'item'})
changed: [localhost] => (item={'started': 1, 'finished': 0, 'ansible_job_id': '970342794636.53100', 'results_file': '/home/igor/.ansible_async/970342794636.53100', 'changed': True, 'failed': False, 'item': {'image': 'docker.io/pycontribs/debian:latest', 'name': 'instance_deb', 'pre_build_image': True}, 'ansible_loop_var': 'item'})
changed: [localhost] => (item={'started': 1, 'finished': 0, 'ansible_job_id': '575552193107.53135', 'results_file': '/home/igor/.ansible_async/575552193107.53135', 'changed': True, 'failed': False, 'item': {'image': 'docker.io/pycontribs/alpine:latest', 'name': 'instance_alpine', 'pre_build_image': True}, 'ansible_loop_var': 'item'})

PLAY RECAP *********************************************************************************************************************************************************************************************
localhost                  : ok=5    changed=2    unreachable=0    failed=0    skipped=4    rescued=0    ignored=0

INFO     Running default > prepare
WARNING  Skipping, prepare playbook not configured.
INFO     Running default > converge

PLAY [Converge] ****************************************************************************************************************************************************************************************

TASK [Gathering Facts] *********************************************************************************************************************************************************************************
ok: [instance_deb]
ok: [instance_alpine]
ok: [instance_cent]

TASK [Include test] ************************************************************************************************************************************************************************************

TASK [test : Check if we have SUDO with NOPASSWD] ******************************************************************************************************************************************************
ok: [instance_deb]
ok: [instance_alpine]
ok: [instance_cent]

TASK [test : Check connections to public repositories] *************************************************************************************************************************************************
ok: [instance_deb] => (item=http://archive.ubuntu.com)
ok: [instance_alpine] => (item=http://nl.alpinelinux.org/alpine/v3.7/main)
ok: [instance_cent] => (item=http://mirror.centos.org/centos)
ok: [instance_deb] => (item=https://pypi.org/)
ok: [instance_cent] => (item=https://pypi.org/)
ok: [instance_alpine] => (item=https://pypi.org/)

TASK [test : print out] ********************************************************************************************************************************************************************************
ok: [instance_alpine] => {
    "msg": "All items completed"
}
ok: [instance_cent] => {
    "msg": "All items completed"
}
ok: [instance_deb] => {
    "msg": "All items completed"
}

TASK [test : Check if we have connection to docker hub registry] ***************************************************************************************************************************************
ok: [instance_deb]
ok: [instance_cent]
ok: [instance_alpine]

TASK [test : print out] ********************************************************************************************************************************************************************************
ok: [instance_alpine] => {
    "msg": "('https://hub.docker.com/', 200, 'OK (2041 bytes)')"
}
ok: [instance_cent] => {
    "msg": "('https://hub.docker.com/', 200, 'OK (2041 bytes)')"
}
ok: [instance_deb] => {
    "msg": "('https://hub.docker.com/', 200, 'OK (2041 bytes)')"
}

TASK [test : Check if we have enough RAM] **************************************************************************************************************************************************************
ok: [instance_alpine] => {
    "changed": false,
    "msg": "Ok. RAM is enough. 3577 MB available."
}
ok: [instance_cent] => {
    "changed": false,
    "msg": "Ok. RAM is enough. 3577 MB available."
}
ok: [instance_deb] => {
    "changed": false,
    "msg": "Ok. RAM is enough. 3577 MB available."
}

TASK [test : Check if we have enough HDD] **************************************************************************************************************************************************************
ok: [instance_alpine] => {
    "changed": false,
    "msg": "Ok. HDD space is enough. Available 100.4 GB."
}
ok: [instance_cent] => {
    "changed": false,
    "msg": "Ok. HDD space is enough. Available 100.4 GB."
}
ok: [instance_deb] => {
    "changed": false,
    "msg": "Ok. HDD space is enough. Available 100.4 GB."
}

PLAY RECAP *********************************************************************************************************************************************************************************************
instance_alpine            : ok=8    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
instance_cent              : ok=8    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
instance_deb               : ok=8    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0

INFO     Running default > idempotence

PLAY [Converge] ****************************************************************************************************************************************************************************************

TASK [Gathering Facts] *********************************************************************************************************************************************************************************
ok: [instance_deb]
ok: [instance_alpine]
ok: [instance_cent]

TASK [Include test] ************************************************************************************************************************************************************************************

TASK [test : Check if we have SUDO with NOPASSWD] ******************************************************************************************************************************************************
ok: [instance_deb]
ok: [instance_alpine]
ok: [instance_cent]

TASK [test : Check connections to public repositories] *************************************************************************************************************************************************
ok: [instance_deb] => (item=http://archive.ubuntu.com)
ok: [instance_cent] => (item=http://mirror.centos.org/centos)
ok: [instance_alpine] => (item=http://nl.alpinelinux.org/alpine/v3.7/main)
ok: [instance_deb] => (item=https://pypi.org/)
ok: [instance_cent] => (item=https://pypi.org/)
ok: [instance_alpine] => (item=https://pypi.org/)

TASK [test : print out] ********************************************************************************************************************************************************************************
ok: [instance_alpine] => {
    "msg": "All items completed"
}
ok: [instance_cent] => {
    "msg": "All items completed"
}
ok: [instance_deb] => {
    "msg": "All items completed"
}

TASK [test : Check if we have connection to docker hub registry] ***************************************************************************************************************************************
ok: [instance_cent]
ok: [instance_deb]
ok: [instance_alpine]

TASK [test : print out] ********************************************************************************************************************************************************************************
ok: [instance_alpine] => {
    "msg": "('https://hub.docker.com/', 200, 'OK (2041 bytes)')"
}
ok: [instance_cent] => {
    "msg": "('https://hub.docker.com/', 200, 'OK (2041 bytes)')"
}
ok: [instance_deb] => {
    "msg": "('https://hub.docker.com/', 200, 'OK (2041 bytes)')"
}

TASK [test : Check if we have enough RAM] **************************************************************************************************************************************************************
ok: [instance_alpine] => {
    "changed": false,
    "msg": "Ok. RAM is enough. 3570 MB available."
}
ok: [instance_cent] => {
    "changed": false,
    "msg": "Ok. RAM is enough. 3569 MB available."
}
ok: [instance_deb] => {
    "changed": false,
    "msg": "Ok. RAM is enough. 3572 MB available."
}

TASK [test : Check if we have enough HDD] **************************************************************************************************************************************************************
ok: [instance_alpine] => {
    "changed": false,
    "msg": "Ok. HDD space is enough. Available 100.4 GB."
}
ok: [instance_cent] => {
    "changed": false,
    "msg": "Ok. HDD space is enough. Available 100.4 GB."
}
ok: [instance_deb] => {
    "changed": false,
    "msg": "Ok. HDD space is enough. Available 100.4 GB."
}

PLAY RECAP *********************************************************************************************************************************************************************************************
instance_alpine            : ok=8    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
instance_cent              : ok=8    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
instance_deb               : ok=8    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0

INFO     Idempotence completed successfully.
INFO     Running default > side_effect
WARNING  Skipping, side effect playbook not configured.
INFO     Running default > verify
INFO     Running Ansible Verifier

PLAY [Verify] ******************************************************************************************************************************************************************************************

TASK [Example assertion] *******************************************************************************************************************************************************************************
ok: [instance_alpine] => {
    "changed": false,
    "msg": "All assertions passed"
}
ok: [instance_deb] => {
    "changed": false,
    "msg": "All assertions passed"
}
ok: [instance_cent] => {
    "changed": false,
    "msg": "All assertions passed"
}

PLAY RECAP *********************************************************************************************************************************************************************************************
instance_alpine            : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
instance_cent              : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
instance_deb               : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0

INFO     Verifier completed successfully.
INFO     Running default > cleanup
WARNING  Skipping, cleanup playbook not configured.
INFO     Running default > destroy

PLAY [Destroy] *****************************************************************************************************************************************************************************************

TASK [Destroy molecule instance(s)] ********************************************************************************************************************************************************************
changed: [localhost] => (item=instance_cent)
changed: [localhost] => (item=instance_deb)
changed: [localhost] => (item=instance_alpine)

TASK [Wait for instance(s) deletion to complete] *******************************************************************************************************************************************************
FAILED - RETRYING: Wait for instance(s) deletion to complete (300 retries left).
changed: [localhost] => (item={'started': 1, 'finished': 0, 'ansible_job_id': '948455147214.61480', 'results_file': '/home/igor/.ansible_async/948455147214.61480', 'changed': True, 'failed': False, 'item': {'image': 'docker.io/pycontribs/centos:7', 'name': 'instance_cent', 'pre_build_image': True}, 'ansible_loop_var': 'item'})
changed: [localhost] => (item={'started': 1, 'finished': 0, 'ansible_job_id': '523938241507.61504', 'results_file': '/home/igor/.ansible_async/523938241507.61504', 'changed': True, 'failed': False, 'item': {'image': 'docker.io/pycontribs/debian:latest', 'name': 'instance_deb', 'pre_build_image': True}, 'ansible_loop_var': 'item'})
changed: [localhost] => (item={'started': 1, 'finished': 0, 'ansible_job_id': '348722892524.61527', 'results_file': '/home/igor/.ansible_async/348722892524.61527', 'changed': True, 'failed': False, 'item': {'image': 'docker.io/pycontribs/alpine:latest', 'name': 'instance_alpine', 'pre_build_image': True}, 'ansible_loop_var': 'item'})

TASK [Delete docker network(s)] ************************************************************************************************************************************************************************

PLAY RECAP *********************************************************************************************************************************************************************************************
localhost                  : ok=2    changed=2    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0

INFO     Pruning extra files from scenario ephemeral directory
```

## Test role on work_hosts

```bash
it-academy.by/07.Ansible.Cruise [ ansible-playbook -i inv.yaml test.yaml                                                                                                                                            master * ] 4:24 

PLAY [work_hosts] *******************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] **************************************************************************************************************************************************************************************************************
Friday 09 July 2021  16:25:02 +0300 (0:00:00.027)       0:00:00.027 *********** 
ok: [work_02]
ok: [work_01]

TASK [test : Check if we have SUDO with NOPASSWD] ***********************************************************************************************************************************************************************************
Friday 09 July 2021  16:25:06 +0300 (0:00:04.765)       0:00:04.793 *********** 
ok: [work_02]
ok: [work_01]

TASK [test : Check connections to public repositories] ******************************************************************************************************************************************************************************
Friday 09 July 2021  16:25:08 +0300 (0:00:01.681)       0:00:06.475 *********** 
ok: [work_02] => (item=http://archive.ubuntu.com)
ok: [work_01] => (item=http://mirror.centos.org/centos)
ok: [work_02] => (item=https://pypi.org/)
ok: [work_01] => (item=https://pypi.org/)

TASK [test : print out] *************************************************************************************************************************************************************************************************************
Friday 09 July 2021  16:25:14 +0300 (0:00:05.649)       0:00:12.124 *********** 
ok: [work_01] => {
    "msg": "All items completed"
}
ok: [work_02] => {
    "msg": "All items completed"
}

TASK [test : Check if we have connection to docker hub registry] ********************************************************************************************************************************************************************
Friday 09 July 2021  16:25:14 +0300 (0:00:00.107)       0:00:12.232 *********** 
ok: [work_02]
ok: [work_01]

TASK [test : print out] *************************************************************************************************************************************************************************************************************
Friday 09 July 2021  16:25:17 +0300 (0:00:03.323)       0:00:15.556 *********** 
ok: [work_02] => {
    "msg": "('https://hub.docker.com/', 200, 'OK (2041 bytes)')"
}
ok: [work_01] => {
    "msg": "('https://hub.docker.com/', 200, 'OK (2041 bytes)')"
}

TASK [test : Check if we have enough RAM] *******************************************************************************************************************************************************************************************
Friday 09 July 2021  16:25:17 +0300 (0:00:00.113)       0:00:15.670 *********** 
ok: [work_01] => {
    "changed": false,
    "msg": "Ok. RAM is enough. 3515 MB available."
}
ok: [work_02] => {
    "changed": false,
    "msg": "Ok. RAM is enough. 3391 MB available."
}

TASK [test : Check if we have enough HDD] *******************************************************************************************************************************************************************************************
Friday 09 July 2021  16:25:17 +0300 (0:00:00.128)       0:00:15.798 *********** 
ok: [work_01] => {
    "changed": false,
    "msg": "Ok. HDD space is enough. Available 17.7 GB."
}
ok: [work_02] => {
    "changed": false,
    "msg": "Ok. HDD space is enough. Available 17.3 GB."
}

PLAY RECAP **************************************************************************************************************************************************************************************************************************
work_01                    : ok=8    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
work_02                    : ok=8    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

Friday 09 July 2021  16:25:18 +0300 (0:00:00.090)       0:00:15.889 *********** 
=============================================================================== 
test : Check connections to public repositories ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ 5.65s
Gathering Facts -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 4.77s
test : Check if we have connection to docker hub registry -------------------------------------------------------------------------------------------------------------------------------------------------------------------- 3.32s
test : Check if we have SUDO with NOPASSWD ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 1.68s
test : Check if we have enough RAM ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 0.13s
test : print out ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 0.11s
test : print out ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 0.11s
test : Check if we have enough HDD ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 0.09s
Playbook run took 0 days, 0 hours, 0 minutes, 15 seconds
```
