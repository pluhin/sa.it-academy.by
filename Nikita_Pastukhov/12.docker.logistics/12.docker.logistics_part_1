# 12.Docker.Logistics part 1.Automate task 11

# Dockerfile, Jenkinsfile you can see in git:

[Link to git](https://github.com/kiticonbit/for_ht_docker)

###### At work i used plugin "Git organization". I push my Jenkinsfile in git and Jenkins build image and push it to Dockerhub automaticaly. I can run pipeline manual or, for example, at night or use another scheduler.



# Output Jenkins pipeline

```bash
Started by user kit
16:01:18 Connecting to https://api.github.com using kiticonbit/******
Obtained Jenkinsfile from b700345ddf219d6c54562195e34e552fbdf2ac7a
Running in Durability level: MAX_SURVIVABILITY
[Pipeline] Start of Pipeline
[Pipeline] node
Running on Jenkins in /var/lib/jenkins/workspace/test_for_ht_docker_master
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Declarative: Checkout SCM)
[Pipeline] checkout
using credential github
 > git rev-parse --is-inside-work-tree # timeout=10
Fetching changes from the remote Git repository
 > git config remote.origin.url https://github.com/kiticonbit/for_ht_docker.git # timeout=10
Fetching without tags
Fetching upstream changes from https://github.com/kiticonbit/for_ht_docker.git
 > git --version # timeout=10
using GIT_ASKPASS to set credentials 
 > git fetch --no-tags --progress https://github.com/kiticonbit/for_ht_docker.git +refs/heads/master:refs/remotes/origin/master
Checking out Revision b700345ddf219d6c54562195e34e552fbdf2ac7a (master)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f b700345ddf219d6c54562195e34e552fbdf2ac7a
Commit message: "add jenkinsfile"
 > git rev-list --no-walk b700345ddf219d6c54562195e34e552fbdf2ac7a # timeout=10
[Pipeline] }
[Pipeline] // stage
[Pipeline] withEnv
[Pipeline] {
[Pipeline] withEnv
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Cloning Git)
[Pipeline] git
No credentials specified
 > git rev-parse --is-inside-work-tree # timeout=10
Fetching changes from the remote Git repository
 > git config remote.origin.url https://github.com/kiticonbit/for_ht_docker.git # timeout=10
Fetching upstream changes from https://github.com/kiticonbit/for_ht_docker.git
 > git --version # timeout=10
 > git fetch --tags --progress https://github.com/kiticonbit/for_ht_docker.git +refs/heads/*:refs/remotes/origin/*
 > git rev-parse refs/remotes/origin/master^{commit} # timeout=10
 > git rev-parse refs/remotes/origin/origin/master^{commit} # timeout=10
Checking out Revision b700345ddf219d6c54562195e34e552fbdf2ac7a (refs/remotes/origin/master)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f b700345ddf219d6c54562195e34e552fbdf2ac7a
 > git branch -a -v --no-abbrev # timeout=10
 > git branch -D master # timeout=10
 > git checkout -b master b700345ddf219d6c54562195e34e552fbdf2ac7a
Commit message: "add jenkinsfile"
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Building image)
[Pipeline] script
[Pipeline] {
[Pipeline] sh
+ docker build -t kiticonbittt/docker_home_task:9 .
Sending build context to Docker daemon  77.82kB

Step 1/7 : FROM python:3.6.9-alpine
 ---> f00bde8f9c15
Step 2/7 : MAINTAINER n.pastukhov@velcom.by
 ---> Using cache
 ---> c26a1f949057
Step 3/7 : WORKDIR /opt
 ---> Using cache
 ---> d76bca75603a
Step 4/7 : COPY . /opt
 ---> ea7a499287f1
Step 5/7 : RUN pip3 install --trusted-host pypi.python.org -r requirements.txt
 ---> Running in a4150b46a8cd
Collecting flask (from -r requirements.txt (line 1))
  Downloading https://files.pythonhosted.org/packages/9b/93/628509b8d5dc749656a9641f4caf13540e2cdec85276964ff8f43bbb1d3b/Flask-1.1.1-py2.py3-none-any.whl (94kB)
Collecting itsdangerous>=0.24 (from flask->-r requirements.txt (line 1))
  Downloading https://files.pythonhosted.org/packages/76/ae/44b03b253d6fade317f32c24d100b3b35c2239807046a4c953c7b89fa49e/itsdangerous-1.1.0-py2.py3-none-any.whl
Collecting Werkzeug>=0.15 (from flask->-r requirements.txt (line 1))
  Downloading https://files.pythonhosted.org/packages/d1/ab/d3bed6b92042622d24decc7aadc8877badf18aeca1571045840ad4956d3f/Werkzeug-0.15.5-py2.py3-none-any.whl (328kB)
Collecting click>=5.1 (from flask->-r requirements.txt (line 1))
  Downloading https://files.pythonhosted.org/packages/fa/37/45185cb5abbc30d7257104c434fe0b07e5a195a6847506c074527aa599ec/Click-7.0-py2.py3-none-any.whl (81kB)
Collecting Jinja2>=2.10.1 (from flask->-r requirements.txt (line 1))
  Downloading https://files.pythonhosted.org/packages/1d/e7/fd8b501e7a6dfe492a433deb7b9d833d39ca74916fa8bc63dd1a4947a671/Jinja2-2.10.1-py2.py3-none-any.whl (124kB)
Collecting MarkupSafe>=0.23 (from Jinja2>=2.10.1->flask->-r requirements.txt (line 1))
  Downloading https://files.pythonhosted.org/packages/b9/2e/64db92e53b86efccfaea71321f597fa2e1b2bd3853d8ce658568f7a13094/MarkupSafe-1.1.1.tar.gz
Building wheels for collected packages: MarkupSafe
  Building wheel for MarkupSafe (setup.py): started
  Building wheel for MarkupSafe (setup.py): finished with status 'done'
  Stored in directory: /root/.cache/pip/wheels/f2/aa/04/0edf07a1b8a5f5f1aed7580fffb69ce8972edc16a505916a77
Successfully built MarkupSafe
Installing collected packages: itsdangerous, Werkzeug, click, MarkupSafe, Jinja2, flask
Successfully installed Jinja2-2.10.1 MarkupSafe-1.1.1 Werkzeug-0.15.5 click-7.0 flask-1.1.1 itsdangerous-1.1.0
[91mWARNING: You are using pip version 19.1.1, however version 19.2.1 is available.
You should consider upgrading via the 'pip install --upgrade pip' command.
[0mRemoving intermediate container a4150b46a8cd
 ---> 769241855a2b
Step 6/7 : EXPOSE 5050
 ---> Running in 3ad16023a1fd
Removing intermediate container 3ad16023a1fd
 ---> 45ce49ef1ccb
Step 7/7 : CMD ["python3", "test.py"]
 ---> Running in a8b20180cbc8
Removing intermediate container a8b20180cbc8
 ---> 2a25be672d76
Successfully built 2a25be672d76
Successfully tagged kiticonbittt/docker_home_task:9
[Pipeline] dockerFingerprintFrom
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Deploy Image)
[Pipeline] script
[Pipeline] {
[Pipeline] withEnv
[Pipeline] {
[Pipeline] withDockerRegistry
$ docker login -u kiticonbittt -p ******** https://index.docker.io/v1/
WARNING! Using --password via the CLI is insecure. Use --password-stdin.
WARNING! Your password will be stored unencrypted in /var/lib/jenkins/workspace/test_for_ht_docker_master@tmp/54b6d877-3934-43a9-abc7-de60e6abb239/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store

Login Succeeded
[Pipeline] {
[Pipeline] sh
+ docker tag kiticonbittt/docker_home_task:9 kiticonbittt/docker_home_task:9
[Pipeline] sh
+ docker push kiticonbittt/docker_home_task:9
The push refers to repository [docker.io/kiticonbittt/docker_home_task]
d69aa27925ce: Preparing
ab7f381c4c36: Preparing
223ac23e07c4: Preparing
4701c3ce4fd3: Preparing
f1064cf9fa6f: Preparing
622ce7163ec3: Preparing
1bfeebd65323: Preparing
622ce7163ec3: Waiting
1bfeebd65323: Waiting
f1064cf9fa6f: Layer already exists
4701c3ce4fd3: Layer already exists
223ac23e07c4: Layer already exists
622ce7163ec3: Layer already exists
1bfeebd65323: Layer already exists
ab7f381c4c36: Pushed
d69aa27925ce: Pushed
9: digest: sha256:b8f373bfe0772a7f0119d16937075cc7b444f76c4eb9c3114e50b9dc49a78862 size: 1788
[Pipeline] }
[Pipeline] // withDockerRegistry
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Remove Unused docker image)
[Pipeline] sh
+ docker rmi kiticonbittt/docker_home_task:9
Untagged: kiticonbittt/docker_home_task:9
Untagged: kiticonbittt/docker_home_task@sha256:b8f373bfe0772a7f0119d16937075cc7b444f76c4eb9c3114e50b9dc49a78862
Deleted: sha256:2a25be672d7692f846c6fda64d5411cd667fb7978e5aa011d3921497528d0f7f
Deleted: sha256:45ce49ef1ccb79c1750f3f6607ad2ad5471c02cf4f827edf4875d8a5aae42471
Deleted: sha256:769241855a2b2e9943ccae150912922b9235b8602f97a7c9a21e0644c425cd47
Deleted: sha256:3ee9c16e40fec963aaa5f0b1211ca24f4f43ad3ffb776f20c9c76d46ec4f1354
Deleted: sha256:ea7a499287f1ef42759f5de1470d9f50884525daa69e3add0b7d37ac2d3b6a1e
Deleted: sha256:3727c26180055cd80ea724f8692e865bb3a8e75c06bee1db03093f7681d104d5
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // node
[Pipeline] End of Pipeline

GitHub has been notified of this commitâ€™s build result

Finished: SUCCESS
```