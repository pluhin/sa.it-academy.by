- name: Debian repo
  include: debian_repo.yaml
  when: ansible_os_family == 'Debian'

- name: RedHat repo
  include: redhat_repo.yaml
  when: ansible_os_family == 'RedHat'

- name: Make sure we have user with sudo and NOPASSWD
  shell: cat /etc/sudoers | grep {{ hostvars[inventory_hostname].ansible_user }}
  register: usr
  ignore_errors: yes
  changed_when: False
  tags:
    - sudoers
- name: Check user permission
  debug:
    msg: "{{ usr.stdout }}"
  tags:
    - sudoersprint
- name: Check if we have enough disk space
  assert:
    that:
      - not {{ item.mount == '/' and ( item.size_available < item.size_total - ( item.size_total|float * 0.8 ) ) }}
  with_items: "{{ ansible_mounts }}"
  ignore_errors: yes
  register: disk_free
- name: available disk space
  debug:
    msg: "{{ disk_free }}"
- name: check for available memory
  debug:
    msg: "total RAM is {{ ansible_memory_mb.real.total }}"
- name: alarm check memory free
  ignore_errors: yes
  assert:
    that:
        - ansible_memtotal_mb >= {{ memlimit }}|int
