---
- name: Make sure we have user with sudo and NOPASSWD
  command: cat /etc/sudoers.d/petya
  register: usr
  ignore_errors: yes
  changed_when: False

- name: Check user permission
  debug:
    msg: "{{ usr.stdout }}"

- name: debian system repository
  include: debian.yaml
  when: ansible_os_family == 'Debian'

- name: repository redhat system
  include: redhat.yaml
  when: ansible_os_family == 'RedHat'

- name: Check if we have enough disk space
  assert:
    that:
      - not {{ item.mount == '/' and ( item.size_available < item.size_total - ( item.size_total|float * 0.8 ) ) }}
  with_items: "{{ ansible_mounts }}"
  ignore_errors: yes
  register: disk_free

- name: available disk space
  debug:
    msg: "{{ disk_free }}"

- name: chek for available memory
  debug:
    msg: "total RAM is {{ ansible_memory_mb.real.total }}"

- name: alarm check memory free
  debug:
    msg: "not enough RAM"
  when: ansible_memory_mb <= 1024