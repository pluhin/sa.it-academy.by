---
- name: Check SUDO without password
  command: "true"
  become: yes
  become_method: sudo
  changed_when: false
  
- name: Check connectivity to repos in Debian
  apt:
    update_cache: yes
  when: ansible_os_family == "Debian"
  changed_when: false
    
- name: Check connectivity to repos in RedHat
  yum:
    name: "*"
    update_cache: yes
  when: ansible_os_family == "RedHat"
  
- name: Check connectivity to PIP repos
  uri:
    url: "https://files.pythonhosted.org/packages/af/dc/4c2cbece71e480d09b8e8f6fd6c6c8849e7b65a591a7cd7a3e66085630d1/molecule-3.0.6.tar.gz"
    
- name: Check connectivity to DockerHub
  uri:
    url: "https://hub.docker.com"
    return_content: yes
  register: this
  failed_when:
    - "'<title>Docker Hub</title>' not in this.content"

- name: Check RAM
  debug:
    msg: "{{ ansible_memtotal_mb }} MB. We need {{ requirements.ram_mb }} MB"
  failed_when: ansible_memtotal_mb < requirements.ram_mb
  
- name: Calculate HDD available space
  set_fact: hdd_available={{ ((ansible_mounts | first).size_available / 1024 / 1024) | round(1,'common') }}

- name: Check if HDD space is enough
  debug:
    msg: "{{ hdd_available }} MB. We need {{ requirements.hdd_mb | float }} MB"
  failed_when: hdd_available | float < requirements.hdd_mb
